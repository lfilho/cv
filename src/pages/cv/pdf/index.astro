---
import { readFile } from "node:fs/promises";
import path from "node:path";

const isDev = import.meta.env.DEV;

try {
    const currentModuleUrl = new URL(import.meta.url);
    const currentModuleDirname = path.dirname(currentModuleUrl.pathname);

    let filePath = path.join(currentModuleDirname, "..", "..", "..", "..");
    const fileName = 'Luiz_Gonzaga_dos_Santos_Filho_-_Software_Engineering_Resume.pdf';
    // Gets generated by build command and lives in the dist folder
    // TODO: Find a way to get the file name dynamically
    if (isDev) {
        filePath += "/dist/";
    }
    filePath += `/cv/pdf/${fileName}`;
    
    const fileBuffer = await readFile(filePath);

    return new Response(fileBuffer, {
        headers: {
            "Content-Type": "application/pdf",
            "Content-Disposition": `inline; filename=${fileName}`
        },
    });
} catch (error) {
    throw new Error(`Error in thePDF route: ${error}`);
}
---
